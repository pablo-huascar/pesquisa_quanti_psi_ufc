---
title: "Construindo intui√ß√µes sobre conceitos estat√≠sticos"
subtitle: "Probabilidade"
format: 
  revealjs:
      logo: img/brasao1_horizontal_cor_300dpi.png
      theme: simple
      css: logo.css
progress: true
slide-number: true
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
source("./_common.R")
```

```{r}
#| label: setup

library(tidyverse)
library(janitor)
library(UsingR)
library(carData)
library(palmerpenguins)
library(gt)
library(scales)
library(ggthemes)
library(patchwork)
library(DT)
library(psych)
conflicted::conflicts_prefer(dplyr::filter())
conflicted::conflicts_prefer(dplyr::select())
conflicted::conflicts_prefer(dplyr::lag())
conflicted::conflicts_prefer(dplyr::summarize)
conflicted::conflicts_prefer(dplyr::summarise)
conflicted::conflicts_prefer(scales::alpha)
conflicted::conflicts_prefer(scales::rescale)
```

```{r}
df <- TitanicSurvival |> 
  as_tibble() |> 
  clean_names() |> 
  mutate(
    sex = fct_recode(sex, Masculino = "male", Feminino = "female"),
    passenger_class = fct_recode(passenger_class, Primeira = "1st",
                                 Segunda = "2nd", Terceira = "3rd"),
    survived = fct_recode(survived, Sim = "yes", N√£o = "no"), 
    crianca = case_when(age <= 11 ~ "Crian√ßa",
                        .default = "Demais passagerios")
  )
```

# Testemunhando a viagem do Titanic

##  {background-image="img/titanic.png" background-size="contain"}

## Os viajantes do tempo

::::: columns
::: {.column width="40%"}
![](img/maquina-do-tempo.png)
:::

::: {.column width="60%" style="font-size: 20pt"}
Ao terminar a disciplina de pesquisa quantitativa, voc√™s se tornaram cientistas muito bons e conseguiram criar uma m√°quina do tempo. Para a primeira expedi√ß√£o temporal, por serem f√£s do James Cameron, decidiram testemunhar como foi a viagem no Titanic. O aparelho que voc√™s constru√≠ram, contudo, s√≥ permite que uma pessoa fa√ßa o salto temporal. Antes de se aventurar, voc√™s precisam avaliar quem vai ter maiores chances de sobreviver e em qual classe do navio deve viajar. Com base nos dados dispon√≠veis sobre a viagem, voc√™s v√£o escolher aquele que vai testemunhar esse evento hist√≥rico e voltar para contar como ele ocorreu.
:::
:::::

## O que sabemos sobre os passageiros

```{r}
sexo <- df |> 
  count(sex) |> 
  mutate(
    "%" = n/sum(n)
  ) |> 
  rename(Vari√°vel = sex)

classe <- df |> 
  count(passenger_class) |> 
  mutate(
    "%" = n/sum(n)
  ) |> 
  rename(Vari√°vel = passenger_class)

sobreviventes <- df |> 
  count(survived) |> 
  mutate(
    "%" = n/sum(n)
  ) |> 
  rename(Vari√°vel = survived)

tabela_1 <- sexo |> 
  bind_rows(classe) |> 
  bind_rows(sobreviventes)

```

```{r}
tabela_1 |>   
  gt() |> 
  tab_row_group(
    label = "Sobrevientes",
    rows = 6:7
  ) |> 
  tab_row_group(
    label = "Classe",
    rows = 3:5
  ) |> 
  tab_row_group(
    label = "G√™nero",
    rows = 1:2
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  cols_align(
    align = "center", columns = c(2,3)  
  ) |> 
  cols_align(
    align = "left", columns = 1  
  ) |> 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = Vari√°vel)
  ) |> 
  fmt_percent(
    columns = "%",
    decimals = 1
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

## Qual a chance de sobrevier por classe do navio?

```{r}
abs_classe <- df |> 
  count(passenger_class, survived) |> 
  rename(Classe = passenger_class, Sobreviv√™ncia = survived)
```

```{r}
abs_classe |> 
  gt() |> 
  cols_align(
    align = "center",  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

## Qual a chance de sobrevier por classe do navio?

```{r}
prop_classe <- df |> 
  count(passenger_class, survived) |> 
  mutate(
    Propor√ß√£o = n/sum(n),
    Propor√ß√£o = percent_format(accuracy = 0.1)(Propor√ß√£o),
    .by = passenger_class
  ) |> 
  rename(Classe = passenger_class, Sobreviv√™ncia = survived)
```

```{r}
prop_classe |> 
  gt() |> 
  cols_align(
    align = "center",  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

## Qual a chance de sobrevier por classe do navio?

```{r}
df |> 
  count(passenger_class, survived) |> 
  mutate(
    prop = n/sum(n),
    .by = passenger_class
  ) |> 
  ggplot(
    aes(passenger_class, prop, fill = survived)
    ) + 
  geom_col() +
  geom_text(
    aes(label =  percent_format(accuracy = 0.1)(prop)),
    position = position_fill(vjust = 0.5)
      ) +
  labs(
    x = "Classe",
    y = NULL,
    fill = "Sobreviveu"
  ) +
  scale_y_continuous(labels = percent)
```

## Em qual classe devemos viajar?

Parece haver uma quest√£o de classe na sobreviv√™ncia... Classe social! Os passageiros ricos que viajavam na primeira classe tiveram mais chances de sair com vida.

## Qual a chance de sobrevier por g√™nero?

```{r}
abs_genero <- df |> 
  count(sex, survived) |> 
  rename(G√™nero = sex, Sobreviv√™ncia = survived)
```

```{r}
abs_genero |>   
  gt() |> 
  cols_align(
    align = "center",  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  ) 
```

## Qual a chance de sobrevier por g√™nero?

```{r}
prop_genero <- df |> 
  count(sex, survived) |> 
  mutate(
    Propor√ß√£o = n/sum(n),
    Propor√ß√£o = percent_format(accuracy = 0.1)(Propor√ß√£o),
    .by = sex
  ) |> 
  rename(G√™nero = sex, Sobreviv√™ncia = survived)
```

```{r}
prop_genero |> 
  gt() |> 
  cols_align(
    align = "center",  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

## Qual a chance de sobrevier por g√™nero?

```{r}
df |> 
  count(sex, survived) |> 
  mutate(
    prop = n/sum(n),
    .by = sex
  ) |> 
  ggplot(
    aes(sex, prop, fill = survived)
         ) + 
  geom_col() +
  geom_text(
    aes(label =  percent_format(accuracy = 0.1)(prop)),
    position = position_fill(vjust = 0.5)
  ) + 
  labs(
    x = "G√™nero",
    y = NULL,
    fill = "Sobreviveu"
  ) +
  scale_y_continuous(labels = percent)
```

## "Mulheres e crian√ßas primeiro?"

Parece que aquela frase que dizem nos filmes antigos de naufr√°gio, ‚ÄúMulheres e crian√ßas primeiro‚Äù, era verdade! Vamos ver como isso fica em rela√ß√£o as crian√ßas?

## Qual foi a chance de as crian√ßas sobreviverem em rela√ß√£o aos demais passageiros?

```{r}
abs_crianca <- df |> 
  count(crianca, survived) |> 
  rename(Idade = crianca, Sobreviv√™ncia = survived)
```

```{r}
abs_crianca |> 
  gt() |> 
  cols_align(
    align = "center",  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

::: aside
Foram consideradas crian√ßas passageiros com menos de 12 anos de idade.
:::

## Qual foi a chance de as crian√ßas sobreviverem em rela√ß√£o aos demais passageiros?

```{r}
crianca_prop <- df |> 
  count(crianca, survived) |>
  mutate(
    Propor√ß√£o = n/sum(n),
    Propor√ß√£o = percent_format(accuracy = 0.1)(Propor√ß√£o),
    .by = crianca
  ) |> 
  rename(Idade = crianca, Sobreviv√™ncia = survived)
```

```{r}
crianca_prop |> 
  gt() |> 
  cols_align(
    align = "center",  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

## [Qual foi a chance de as crian√ßas sobreviverem em rela√ß√£o aos demais passageiros?]{style="font-size: 24pt;"}

```{r}
#| out-width: 75%
df |> 
  count(crianca, survived) |> 
  mutate(
    prop = n/sum(n),
    .by = crianca
  ) |> 
  ggplot(
    aes(crianca, prop, fill = survived)
         ) + 
  geom_col() +
  geom_text(
    aes(label =  percent_format(accuracy = 0.1)(prop)),
    position = position_fill(vjust = 0.5)
  ) + 
  labs(
    x = "Idade",
    y = NULL,
    fill = "Sobreviveu"
  ) +
  scale_y_continuous(labels = percent)
```

## Com base nos dados, qual dos ex-alunos de pesquisa quanti deve fazer a viagem no tempo e em qual classe deve embarcar no Titanic? {style="font-size: 16pt;"}

![](img/maquina-do-tempo.png){fig-align="center" width="355"}

# Probabilidade

## O que √© probabilidade?

Probabilidade √© uma maneira de medir o qu√£o prov√°vel √© que um evento aconte√ßa. Ela vai de 0 (imposs√≠vel) a 1 (certeza) ou pode ser representada em porcentagem de 0% a 100%.

## Alguns conceitos b√°sicos

-   Experimento aleat√≥rio: um experimento cujo resultado n√£o pode ser previsto com certeza. Exemplo: lan√ßar uma moeda

-   Espa√ßo Amostral (S): O conjunto de todos os resultados poss√≠veis de um experimento. Exemplo: ao lan√ßar uma moeda, o espa√ßo amostral √© cara ou coroa

-   Evento (E): Um subconjunto do espa√ßo amostral. Exemplo: "sair cara" ao lan√ßar uma moeda.

## F√≥rmula da Probabilidade

A probabilidade de um evento ùê∏ acontecer √© calculada como:

$$
P(E) = \frac{\text{N√∫mero de resultados favor√°veis a } E}
       {\text{N√∫mero total de resultados poss√≠veis}}
$$

## Aplica√ß√µes Simples

-   Moeda: qual a probabilidade de sair cara?
-   Dado: qual a probabilidade de sair um n√∫mero par?
-   Baralho: qual probabilidade de se tirar um √°s de um deck com 52 cartas?

## Moeda: Qual a probabilidade de sair cara?

-   E = cara
-   N√∫mero de resultados favor√°veis a E = 1
-   N√∫mero total de resultados poss√≠veis = 2

$$
P(E) = \frac{1}{2} = 0.5 = 50\%
$$

## Dado: Qual a probabilidade de sair um n√∫mero par?

-   E = n√∫mero par (2, 4 e 6)
-   N√∫mero de resultados favor√°veis a E = 3
-   N√∫mero total de resultados poss√≠veis = 6

$$
P(E) = \frac{3}{6} = \frac{1}{2} = 0.5 = 50\%
$$

## Baralho: qual probabilidade de se tirar um √°s de um deck com 52 cartas?

-   E = √°s (espadas ‚ô†, paus ‚ô£, copas ‚ô• e ouros ‚ô¶)
-   N√∫mero de resultados favor√°veis a E = 4
-   N√∫mero total de resultados poss√≠veis = 52

$$
P(E) = \frac{4}{52} = 0.0769 = 7.7\%
$$
