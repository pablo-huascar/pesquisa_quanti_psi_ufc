---
title: "Inferência"
subtitle: "Comparar duas médias independentes: modelo matemático"
format: 
  revealjs:
      logo: img/brasao1_horizontal_cor_300dpi.png
      theme: simple
      css: logo.css
progress: true
slide-number: true
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
source("C:/projetos-r/pesquisa-quanti-psi-ufc/_common.R")
```

```{r}
#| include: false
source("./_common.R")
```

```{r}
#| label: setup
library(tidyverse)
library(gt)
library(infer)
library(broom)
library(car)
```

# Bancos de dados utilizados

##  {background-image="img/mtcars.png" background-size="contain"}

## `mtcars` {.smaller}

::: {style="font-size: 18pt;"}
Os dados foram extraídos da revista Motor Trend US de 1974 e abrangem o consumo de combustível e 10 aspectos do design e desempenho de automóveis para 32 carros (modelos de 1973-74)

-   Formato: Um banco de dados com `r nrow(mtcars)` observações e `r ncol(mtcars)` variáveis.
    -   `mpg`: milhas/galão (km/l)
    -   `cyl`: número de cilindros
    -   `disp`: cilindrada (polegadas cúbicas)
    -   `hp`: potência bruta (cavalos de potência)
    -   `drat`: relação de transmissão do eixo traseiro
    -   `wt`: peso (1000 lbs)
    -   `qsec`: tempo para 1/4 de milha
    -   `vs`: motor (0 = em forma de V, 1 = reto)
    -   `am`: transmissão (0 = automática, 1 = manual)
    -   `gear`: número de marchas para frente
    -   `carb`: número de carburadores
:::

## Uma olhada em `mtcars`

```{r}
#| label: tbl-mtcars
#| tbl-cap: Uma amostra aleatória de dez casos do banco de dados `mtcars`
#| tbl-cap-location: bottom 

set.seed(123)

mtcars |> 
  rownames_to_column(var = "Modelo") |> 
  as_tibble() |> 
  select(Modelo, wt, mpg, cyl) |> 
  slice_sample(n = 10) |> 
  gt() |> 
  fmt_number(
    decimals = 1
  ) |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
    )
```

## Pacotes

Carregue os pacotes abaixo:

```{r}
#| echo: true
#| eval: false
library(tidyverse)
library(broom)
library(car)
library(infer)
```

# Teste t para amostras independentes {style="font-size: 22pt;"}

## Exemplo {.smaller}

-   Há diferença no consumo de combustível (`mpg`) entre carros com motores em V e retos (`vs`)?

## Manipulação dos dados {.smaller}

::: panel-tabset
### Ações

-   Carregar o conjunto de dados mtcars: `data("mtcars")`
-   Converter os rótulos das lihas para uma coluna: `rownames_to_column()`
-   Transformar em tibble para melhorar a visualização: `as_tibble()`
-   Recodficar a variável independente (`vs`) para facilitar a interpretação dos resultados
-   Transformar a variável independente em fator: `as_factor()`
-   Selecionar e salvar as variáveis que serão utilizadas para facilitar a visualização: `select()`

### Código

```{r}
#| echo: true

# Carregar os dados
data("mtcars") 

dados_teste_t <- mtcars |>
  # Converter os rótulos das lihas
  rownames_to_column(var = "modelo") |> 
  # Transformar em tibble
  as_tibble() |>
  mutate(
    # Recodficar a variável independente
    vs = case_when(vs == 0 ~ "V", 
                   .default = "reto"),
    # Transformar em fator
    vs = as_factor(vs), 
  ) |> 
  # Selecionar as variáveis
  select(modelo, mpg, vs) 
```

### Resultado

```{r}
#| echo: true
dados_teste_t
```
:::

## Exploração dos dados {.smaller}

::: panel-tabset
### Tabela

```{r}
#| echo: true
dados_teste_t |> 
  summarise(
    m = mean(mpg), .by = vs
  ) |> 
  mutate(
    diferenca = m - lag(m)
  )
```

### Gráfico

```{r}
#| echo: true
#| out-width: 70%
dados_teste_t |> 
  ggplot(aes(vs, mpg)) +
  geom_boxplot() +
  stat_boxplot(geom = 'errorbar')
```
:::

## Avaliação de pressupostos

-   Independência entre os grupos
-   Normalidade
-   Homogeneidade das variâncias

## Independência entre os grupos {.smaller}

-   As observações em cada grupo devem ser independentes entre si
-   Não deve haver relação ou influência entre as observações dos grupos "V" e "reto"

## Independência entre os grupos {.smaller}

-   Cada linha representa um veículo distinto; não há veículos repetidos (32 modelos, 32 linhas)

```{r}
#| echo: true
n_distinct(dados_teste_t$modelo)
nrow(dados_teste_t)
```

- Cada modelo participa somente de um grupo

```{r}
#| echo: true
dados_teste_t |> 
  count(vs, modelo) |> 
  distinct(vs, n)
```


## Normalidade: teste de Shapiro-Wilk

-   Hipóteses:
    -   $H_0$: a variável de interesse é oriunda de uma população com distribuição normal
    -   $H_a$: a variável de interesse não é oriunda de uma população com distribuição normal
-   Avaliar a normalidade da VD (`mgp`) para cada grupo da VI  (`vs`):
    -   "V" e "reto"

## Normalidade: `shapiro.test()`

-   Valores ausentes são permitidos, mas o número de valores não ausentes deve estar entre 3 e 5000
-   Argumentos:

```{r}
#| echo: true
#| eval: false
shapiro.test(x = vetor numérico)
```

## Normalidade: `shapiro.test()`

::: panel-tabset
### V

```{r}
#| echo: true
dados_teste_t |> 
  filter(vs == "V") |> 
  select(mpg) |> 
  pull() |> 
  shapiro.test() |> 
  tidy()
```

### reto

```{r}
#| echo: true
dados_teste_t |> 
  filter(vs == "reto") |> 
  select(mpg) |> 
  pull() |> 
  shapiro.test() |> 
  tidy()
```

### Passo-a-passo do código

```{r}
#| echo: true
#| eval: false
dados_teste_t |>
  # Filtar os dados do grupo 
  filter(vs == "straight") |> 
  # Selecionar a variável dependente
  select(mpg) |> 
  # Extrair os valores da coluna
  pull() |> 
  # Realizar o teste
  shapiro.test() |> 
  # Transformar o objeto em uma tibble "tidy" 
  # para melhorar a visualização do resultado
  tidy()
```
:::

## Homogeneidade de Variâncias: teste de Levene

- Hipóteses:
    - $H_0$: As variâncias populacionais são iguais entre os grupos
    - $H_a$: As variâncias populacionais não são iguais entre os grupos
- Avaliar a homogeneidade de variâncias da VD (`mpg`) entre os grupos da VI (`vs`):
    - "V" e "reto"

## Homogeneidade de Variâncias: `car::leveneTest()`

-   Argumentos:

```{r}
#| echo: true
#| eval: false
leveneTest(VD ~ VI, center = c("mean", "median"), data = dados)
```

center: "mean" fornece o teste de Levene original; o padrão, "median", fornece um teste mais robusto

## Homogeneidade de Variâncias: `car::leveneTest()`

```{r}
#| echo: true
leveneTest(mpg ~ vs, center = "mean", dados_teste_t) |> 
  tidy()
```

## Teste t para amostras independentes

-   Hipóteses (Bilateral):
    -   Nula: a média do consumo de combustível dos carros com motores em V é igual à média dos carros com motores retos
        -   $$H_0: \mu_{\text{V}} = \mu_{\text{reto}}$$
    -   Alternativa: a média do consumo de combustível dos carros com motores em V-shaped é diferente da média dos carros com motores straight
        -   $$ H_a: \mu_{\text{V}} \ne \mu_{\text{reto}} $$

## Teste t para amostras independentes: `infer::t_test()`

- Argumentos:

```{r}
#| echo: true
#| eval: false
t_test(x = dados, response = VD, explanatory = VI,
       order = c("grupo_1", "grupo_2"), 
       alternative = c("two-sided", "greater", "less"),
       var.equal = F)
```

## Teste t para amostras independentes: `infer::t_test()`

```{r}
#| echo: true
dados_teste_t |> 
  t_test(
    response = mpg, explanatory = vs,
    order = c("reto", "V"), var.equal = T,
    alternative = "two.sided"
  )
```

