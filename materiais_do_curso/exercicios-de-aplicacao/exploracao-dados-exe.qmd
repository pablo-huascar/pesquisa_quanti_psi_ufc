---
title: "Exploração de dados: exercícios"
editor: visual
format: html
toc: true
editor_options: 
  chunk_output_type: console
eval: false
---

```{r}
#| include: false
source("C:/projetos-r/pesquisa-quanti-psi-ufc/_common.R")
```

```{r}
#| label: setup

library(tidyverse)
library(janitor)
library(gt)
library(scales)
library(ggthemes)
library(patchwork)
library(DT)
conflicted::conflicts_prefer(dplyr::filter())
conflicted::conflicts_prefer(dplyr::select())
conflicted::conflicts_prefer(dplyr::lag())
conflicted::conflicts_prefer(dplyr::summarize)
conflicted::conflicts_prefer(dplyr::summarise)
conflicted::conflicts_prefer(scales::alpha)
conflicted::conflicts_prefer(scales::rescale)
```

```{r}
#| label: data

brasileiro <- read_csv("C:/projetos-r/pesquisa-quanti-psi-ufc/data/brasileiro_2014_2023.csv")
```

## Introdução

Você foi contratado como analista de dados de um canal no YouTube que tem programas de esportes, curiosidades, política, dentre outros. Os apresentadores precisam de informações precisas para usar nas transmissões. Sua missão é analisar bancos de dados e responder as questões e demandas abaixo que foram enviadas por cada equipe.

### Esportes

Você recebeu o banco de dados `brasileiro_2014_2023` com informações sobre os campeonatos brasileiros de futebol entre os anos de 2014 e 2023.

-   Formato: mm banco de dados com `r nrow(brasileiro)` observações e `r ncol(brasileiro)` variáveis:
    -   `campeonato`: ano do campeonato
    -   `partida`: sequência da partida
    -   `data`: data da partida
    -   `gols`: quantidade gols do time
    -   `pontos`: pontos obtidos pelo time
    -   `gols_por_partida`: gols da partida
    -   `estadio`: estádio em que a partida foi realizada
    -   `mando_de_campo`: o time jogou a partida em casa (Mandante) ou fora de casa (Visitante)

```{r}
#| label: tbl-brasileiro
#| tbl-cap: Uma amostra de dez casos do banco de dados `brasileiro_2014_2023`
#| tbl-cap-location: bottom
brasileiro |> 
  filter(campeonato == 2023) |> 
  slice(1:10) |> 
  gt() |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

A equipe do programa de esportes precisa das seguintes informações sobre todo o período compreendido nos dados (2014 a 2023), a não ser que a demanda diga o contrário:

**Quais as pontuações finais e o total de gols dos times foram campeões?**

```{r}
brasileiro |> 
  summarise(
    total_de_pontos = sum(pontos),
    total_de_gols = sum(gols),
    .by = c(campeonato, time)
  ) |> 
  group_by(campeonato) |> 
  slice_max(n = 1, total_de_pontos) |> 
  print(n = Inf)
```

**Quais as pontuações e o total de gols dos times que foram rebaixados?**

```{r}
brasileiro |> 
  summarise(
    total_de_pontos = sum(pontos),
    total_de_gols = sum(gols),
    .by = c(campeonato, time)
  ) |> 
  group_by(campeonato) |> 
  slice_min(n = 4, total_de_pontos)
```

**Quais os times com maiores médias de gols?**

```{r}
#| eval: false
brasileiro |> 
  summarise(
    m = mean(gols),
    .by = c(campeonato, time)
  ) |> 
  group_by(campeonato) |> 
  slice_max(m, n = 1) |> 
  arrange(desc(campeonato))
```


**Gere gráficos que comparem o desempenho de gols e pontos entre os times mandantes e visitantes considerando o período como um todo, bem como por cada campeonado**

```{r}
brasileiro |> 
  ggplot(aes(mando_de_campo, gols)) +
  geom_boxplot() +
  facet_wrap(~campeonato)
```

**Agora, gere tabelas que comprarem as médias de gols e de ponto sentre times mandantes e visitantes, considerando o período como um todo, bem como por cada campeonado**

```{r}
brasileiro |> 
  summarise(
    m_gols = mean(gols),
    m_pontos = mean(pontos),
    .by = c(mando_de_campo, campeonato)
  )
```



