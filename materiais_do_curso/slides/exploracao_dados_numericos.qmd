---
title: "Explorando dados numéricos"
format: 
  revealjs:
      logo: brasao1_horizontal_cor_300dpi.png
      code-link: true
      code-tools: true
      code-line-numbers: false
      theme: simple
      fig-width: 6
      fig-asp: 0.618
      echo: false
      message: false
      warning: false
progress: true
slide-number: true
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
source("C:/projetos_r/pesquisa_quanti_psi_ufc/_common.R")
```


```{r}
#| label: setup

library(tidyverse)
library(janitor)
library(UsingR)
library(carData)
library(gt)
library(scales)
library(conflicted)
conflicts_prefer(dplyr::filter())
conflicts_prefer(dplyr::select())
conflicts_prefer(dplyr::lag())
set.seed(123)
```

```{r}
#| label: data

father.son <- father.son |> 
  as_tibble()  

airquality <- airquality |> 
  as_tibble()

brasileiro <- read_csv("C:/projetos_r/pesquisa_quanti_psi_ufc/data/brasileiro_2014_2023.csv")
gols_brasileiro <- read_csv("C:/projetos_r/pesquisa_quanti_psi_ufc/data/gols_por_partida_2014_2023.csv")
```

## O que vamos aprender?

-   Explorar dados numéricos usando:
    -   Estatisticas descritivas e
    -   Gráficos

# Gráficos de dispersão para dados pareados

## Banco de dados `father.son`

Conjunto de dados de Pearson sobre alturas de pais e filhos

-   Formato: Um banco de dados com 1078 observações e duas variáveis
    -   `fheighti`: altura do pai em polegadas
    -   `sheight`: altura do filho em polegadas
-   Como você imagina que será a relação entre essas duas variáveis?

## Uma olhada nos dados

```{r}
#| label: tbl-pai-e-filho
#| tbl-cap: Uma amostra aleatória de dez casos do banco de dados `father.son`
#| tbl-cap-location: bottom

father.son |> 
  slice_sample(n = 10) |> 
  gt() |> 
  fmt_number(
    decimals = 1
  ) |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  )
```

## 

```{r}
#| label: pai-e-filho

father.son |> 
  ggplot(aes(fheight, sheight)) +
  geom_jitter(alpha = 0.2, size = 3) +
  geom_smooth(method = "lm", se = F,
              color = "red", linetype = 2) +
  labs(
    title = "Gráfico de dispersão da relação\nentre as alturas dos pais e dos filhos"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5) 
  )
```

## Banco de dados `mtcars`

Os dados foram extraídos da revista Motor Trend US de 1974 e abrangem o consumo de combustível e 10 aspectos do design e desempenho de automóveis para 32 carros (modelos de 1973-74)

-   Formato: Um banco de dados com 234 observações e algumas variáveis. Vamos usar:
    -   `mpg`: milhas/galão (km/l)
    -   `wt`: peso (1000 lbs)
-   Como você imagina que será a relação entre essas duas variáveis?

## Uma olhada nos dados

```{r}
#| label: tbl-mtcars
#| tbl-cap: Uma amostra aleatória de dez casos do banco de dados `mtcars`
#| tbl-cap-location: bottom 

mtcars |> 
  select(wt, mpg) |> 
  slice_sample(n = 10) |> 
  gt() |> 
  fmt_number(
    decimals = 1
  ) |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  )
```

## 

```{r}
mtcars |> 
  ggplot(aes(wt, mpg)) +
  geom_jitter(alpha = 0.2, size = 3) +
  geom_smooth(method = "lm", se = F,
              color = "red",linetype = 2) + 
  labs(
    title = "Gráfico de diserpesão da relação\nentre peso e consumo de combustível"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5) 
  )
```

## Banco de dados `diamonds`

Um conjunto de dados contendo os preços e outros atributos de quase 54.000 diamantes. 

-   Formato: Um banco de dados com 53940 observações e algumas variáveis. Vamos usar:
    -   `price`: preço em dólares americanos
    -   `carat`: peso do diamante (quilates)
-   Como você imagina que será a relação entre essas duas variáveis?

## Uma olhada nos dados

```{r}
#| label: tbl-diamonds 
#| tbl-cap: Uma amostra aleatória de dez casos do banco de dados `diamonds `
#| tbl-cap-location: bottom 

diamonds |> 
  select(carat, price) |> 
  slice_sample(n = 10) |> 
  gt() |> 
  fmt_number(
    decimals = 1
  ) |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  )
```

## 

```{r}
diamonds |> 
  ggplot(aes(carat, price)) +
  geom_jitter(alpha = 0.2, size = 3) +
  geom_smooth(se = F, color = "red",
              linetype = 2) + 
  scale_x_log10() +
  labs(
    title = "Gráfico de diserpesão da relação\nentre o quilate e o preço de diamantes",
    caption = "Diamantes maiores são exponencialmente mais caros"
  ) +
  theme(
    plot.title = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0)
  )
```

## Relação entre o quilate e o preço de diamantes {.smaller}

- Relação exponencial
  -   Uma variável depende da outra elevada a uma potência constante
  -   Crescimento ou decaimento rápido: a variável dependente aumenta ou diminui muito rapidamente à medida que a variável independente aumenta
  -   Gráfico em forma de curva: o gráfico de uma relação exponencial é uma curva suave que se aproxima de zero em um dos extremos e cresce ou decresce rapidamente no outro extremo.
  -   Não linearidade: a relação entre as variáveis não é linear, ou seja, não pode ser representada por uma linha reta.

## Relação entre o quilate e o preço de diamantes

-   Relação exponencial entre o peso e o preço de diamantes:
    -   Diamantes maiores são muito mais raros do que diamantes pequenos, o que aumenta seu preço drasticamente
    -   Diamantes maiores geralmente possuem maior qualidade e pureza, o que também contribui para seu preço elevado

# Gráficos de pontos e a média

## Banco de dados `airquality`

Medições diárias da qualidade do ar em Nova York, de maio a setembro de 1973

-   Formato: Um banco de dados com 153 observações e seis variáveis
    -   `Ozone`: quantidade de ozônio (ppb - partes por bilhão)
    -   `Solar.R`: irradiaçao solar (lang - 1 lang é igual a um caloria por centímetro quadrado)
    -   `	Wind`: velocidade do vento (mph - milhas por hora)
    -   `Temp`: temperatura (F - graus Fahrenheit)
    -   `Month`: mês da medição
    -   `Day`: dia da medição

## Uma olhada nos dados

```{r}
#| label: tbl-airquality
#| tbl-cap: Uma amostra dos dez primeiros casos do banco de dados `airquality`
#| tbl-cap-location: bottom 

airquality |> 
  slice(1:10) |> 
  gt() |> 
  fmt_number(
    decimals = 0
  ) |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  )
```

## O centro dos dados

-   A média é uma maneira de medir o centro de uma distribuição de dados
-   Os gráficos de pontos mostram o valor exato para cada observação

##

```{r}
media <- mean(airquality$Temp)
media <- round(media, 2)

airquality |> 
  ggplot(aes(Temp)) +
  geom_dotplot(color = "#569BBD", fill = "#569BBD", 
               dotsize = 0.7) +
  annotate("point", media, -0.05,
           color = "red", fill = "red", 
           shape = 24, size = 4) + 
  labs(
    title = "Gráfico de pontos para temperatura Nova York",
    subtitle = "Maio a setembro de 1973",
    caption =  "O triângulo vermelho indica a posição da média"
  ) +
  theme(
    axis.title.y = element_blank(),
    axis.text.y = element_blank(),
    axis.ticks.y = element_blank(),
    axis.line.y = element_blank(),
    plot.title = element_text(hjust = 0.5),
    plot.subtitle = element_text(hjust = 0.5),
    plot.caption = element_text(hjust = 0)
  )
```

## Como a média é calculada?

. . .

- A fórmula da média:
$$
\bar{x} = \frac{\sum_{i=1}^n x_i}{n}
$$

. . .

- A formula da média em um formato um pouco mais simples:
$$
\bar{x} = \frac{x_1 + x_2 + \cdots + x_n}{n}
$$

## Um pouco de nomenclaura

::: {.incremental}
-   $\mu$: média da popualação
-   $\bar{x}$: média da amostra 
-   $x$: qualquer caso da amostra
-   $x_i$: representa os valores individuais de forma genérica, onde $i$ é um índice que varia de $1$ (primeiro caso) até $n$ (último caso)
-   $n$: total de casos
:::

## O cáculo da média

Qual foi a média de temperatura dos cinco primeiros dias do mês de maio de 1973 em Nova York?

```{r}
#| label: tbl-cinco-dias-airquality
#| tbl-cap: Temperatura dos cinco primeiros dias do mês de maio de 1973 em Nova York
#| tbl-cap-location: bottom
airquality |> 
  filter(Month == 5, Day <= 5) |> 
  select(Month, Day, Temp) |> 
  gt() |> 
  fmt_number(
    decimals = 0
  ) |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100), 
    table.font.size = "26px"
  )
```

## O cáculo da média


$$
\text{Temp} = \{67, 72, 74, 62, 56\}
$$

. . .

$$
\bar{X} = \frac{67 + 72 + 74 + 62 + 56}{5}
$$

. . .

$$
\bar{X} = \frac{331}{5}
$$

. . .

$$
\bar{X} = 66.2
$$

## A média e a padronização de medidas

-   A média é útil porque nos permite redimensionar ou padronizar uma métrica em algo mais facilmente interpretável e comparável

## A média e a padronização de medidas

-   Um novo medicamento é mais eficaz no tratamento de crises de asma do que o medicamento padrão?
-   Um Teste com 1.500 adultos é delineado: 
    -   500 recebem o novo medicamento 
    -   1.000 recebem um medicamento padrão no grupo de controle

## Resultados

Qual medicamento é mais eficiente?

```{r}
#| label: tbl-asma
#| tbl-cap: Resultados do experimento sobre o novo remédio pra asma
#| tbl-cap-location: bottom

asma <- tribble(
  ~Droga, ~Pacientes, ~Ataques,
  "Nova", 500, 200,
  "Padrão", 1000, 300
) |> 
  mutate(
    "Ataques/paciente" = Ataques/Pacientes
  ) 

asma |>   
  gt() |> 
  cols_hide(
    columns = 4
  ) |> 
  cols_align(
    align = "center",   
  ) |> 
  tab_options(
    table.width = pct(100), 
    table.font.size = "26px"
  )
```

## Resultados

::: {.incremental}
- Qual medicamento é mais eficiente?
  -   Ataques/paciente:
      -   Droga nova: $200/500 = 0.4$
      -   Medicamento padrão: $300/1000 = 0.3$
::: 

. . .

```{r}
#| label: tbl-asma-medias
#| tbl-cap: Resultados do experimento sobre o novo remédio pra asma
#| tbl-cap-location: bottom
asma |>
  gt() |> 
  cols_align(
    align = "center",   
  ) |> 
  tab_options(
    table.width = pct(100), 
    table.font.size = "26px"
  )
```

## Histogramas e forma

-   Os gráficos de pontos mostram o valor exato para cada observação
    -   Úteis para pequenos conjuntos de dados
    -   Difíceis de ler com amostras maiores

## Histogramas e forma {.smaller}
-   Em vez de mostrar o valor de cada observação, vamos colocá-los em caixas ou grupos (bin) formados por intervalos

## Histogramas e forma {.smaller}
-   Variável `Temp` do banco de dados `airquality`: 
        -   0-60, 60-65, 65-70...
-   Na tabela abaixo, estão a contagem de observações que estão em cada intervalo

```{r}
#| label: tbl-bins-temp
#| tbl-cap: Contagens para os dados de temperatura agrupados
#| tbl-cap-location: bottom
cortes <- c(0 ,60 ,65 ,70 ,75 ,80 ,85 , 90, 95, 100) 

airquality |> 
  mutate(
    bins = cut(Temp, breaks = cortes <- c(0 ,60 ,65 ,70 ,75 ,80 ,85 , 90, 95, 100))
  ) |> 
  count(bins) |> 
  gt() |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "22px"
  )
```

    

# Exercícios

## Banco de dados `gols_do_brasileiro`

-   Formato: Um banco de dados com 3.799 observações e cinco variáveis
    -   `campeonato`: o ano do campeonato
    -   `partida`: sequência da partida no campeonato
    -   `data`: data de realização da partida
    -   `estadia`: estádio em que a partida foi realizada
    -   `gols`: número de gols da partida

## Uma olhada nos dados

```{r}
#| label: tbl-gols-do-brasileiro
#| tbl-cap: Uma amostra aleatória de dez casos do banco de dados `gols_do_brasileiro`
#| tbl-cap-location: bottom

gols_brasileiro |> 
  mutate(
    data = format(data, "%d-%m-%Y")
  ) |> 
  slice_sample(n = 10) |> 
  gt() |> 
  fmt_number(
    decimals = 0,sep_mark = ""
  ) |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "22px"
  )
```

