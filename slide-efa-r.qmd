---
title: "Análise Fatorial Exploratória"
subtitle: "Aplicação no R"
format: 
  revealjs:
      logo: img/brasao1_horizontal_cor_300dpi.png
      theme: simple
      css: logo.css
      scrollable: true
progress: true
slide-number: true
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
source("./_common.R")
```

```{r}
#| label: setup
library(tidyverse)
library(janitor)
library(careless)
library(gt)
library(EGAnet)
library(lavaan)
library(MVN)
library(psych)
```

```{r}
cb_racismo_moderno <- read_csv("data/code_book_escala_racismo_moderno.csv")

df <- read_csv("data/dados_racismo_moderno.csv")
```

## Escala de Racismo Moderno {.smaller}

```{r}
cb_racismo_moderno |> 
  gt() |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  cols_align(
    columns = Variáveis,
    align = "center" 
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  ) |> 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = c(Variáveis, Itens,
                                                Fator))
    ) |> 
  tab_options(
    table.font.size = "18px"
  )
```

## Obtenção dos dados

Utilize o código abaixo para baixar o banco de dados e salvá-lo no objeto `df`

```{r}
#| echo: true
#| eval: false
df <- read_csv("https://raw.githubusercontent.com/pablo-huascar/pesquisa_quanti_psi_ufc/refs/heads/main/data/dados_racismo_moderno.csv")
```

## Uma olhada nos dados {.smaller}

```{r}
#| tbl-cap: Uma amostra aleatória de dez casos do banco de dados 
#| tbl-cap-location: bottom
set.seed(123)
df |> 
  slice_sample(n = 10) |> 
  gt() |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "18px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

## Participantes



## Pacotes

Carregue os pacotes abaixo:

```{r}
#| echo: true
#| eval: false
library(tidyverse)
library(careless)
library(MVN)
library(EGAnet)
library(psych)
library(lavaan)
```

# Inspeção de dados (Data screening) 

## Manipulação dos dados

```{r}
#| echo: true
df <- df |> 
  mutate(
    id = 1:n(), .before = 1 # <1>
  )
```

1.  Criar uma coluna para identificação dos casos

## 

## Respostas descuidadas

::: panel-tabset
### `longstring()`

```{r}
respostas_descuidadas <- longstring(escala_de_racismo, avg = T) |> 
  as_tibble() |> 
  mutate(
    id = 1:n(), .before = 1
  ) |> 
  arrange(desc(longstr)) 

respostas_descuidadas
```

### Avaliação dos casos

```{r}
escala_de_racismo |> 
  filter(id %in% c(2, 8, 11, 26))
```

### Retirada dos casos

```{r}
remover_itens <- respostas_descuidadas |> 
  filter(longstr == 14) |> 
  select(id) |> 
  pull()

escala_de_racismo <- escala_de_racismo |> 
  filter(!id %in% remover_itens) |> 
  select(-id)
```
:::

## Avaliação da normalidade dos dados {.smaller}

::: panel-tabset
### Teste

```{r}
#| echo: true
resultado_normalidade <- mvn(
  escala_de_racismo, 
  mvnTest = "mardia",
  univariateTest = "SW"
)
```

### Descritivos

```{r}
#| echo: true
resultado_normalidade$Descriptives |> 
  as_tibble() |> 
  print(n = Inf)
```

### Normalidade univariada

```{r}
#| echo: true
resultado_normalidade$univariateNormality
```

### Normalidade multivariada

```{r}
#| echo: true
resultado_normalidade$multivariateNormality
```
:::


## Fatorabilidade da Matriz de Dados

::: panel-tabset
### KMO

```{r}
escala_de_racismo |> 
  polychoric.matrix() |> 
  KMO()
```

### Teste de esfericidade de Bartlett

```{r}
escala_de_racismo |> 
  polychoric.matrix() |> 
  cortest.bartlett(n = 322)
```
:::


## teste

-   `ordered = T` implica em "WLSMV":

    -   `estimator = "DWLS"`
    -   `se = "robust.sem"`
    -   `test = "scaled.shifted"`

```{r}
#| echo: true
resultado_afe <- efa(
  data = escala_de_racismo,
  ordered = T,
  nfactors = 2,
  rotation = "oblimin",
)
```

## Resultados

```{r}
summary(resultado_afe)
```
