---
title: "Análise Fatorial Exploratória"
subtitle: "Aplicação no R"
format: 
  revealjs:
      logo: img/brasao1_horizontal_cor_300dpi.png
      theme: simple
      css: logo.css
      scrollable: true
progress: true
slide-number: true
editor: visual
editor_options: 
  chunk_output_type: console
---

```{r}
#| include: false
source("./_common.R")
```

```{r}
#| label: setup
library(tidyverse)
library(janitor)
library(haven)
library(readxl)
library(careless)
library(gt)
library(EGAnet)
library(lavaan)
library(MVN)
library(psych)
```

```{r}
cb_racismo_moderno <- read_csv("data/code_book_escala_racismo_moderno.csv")

df <- read_csv("data/dados_racismo_moderno.csv")
```

## Escala de Racismo Moderno {.smaller}

```{r}
cb_racismo_moderno |> 
  gt() |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "26px"
  ) |> 
  cols_align(
    columns = Variáveis,
    align = "center" 
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  ) |> 
  tab_style(
    style = cell_text(align = "center"),
    locations = cells_column_labels(columns = c(Variáveis, Itens,
                                                Fator))
    ) |> 
  tab_options(
    table.font.size = "18px"
  )
```

## Uma olhada nos dados {.smaller}

```{r}
#| tbl-cap: Uma amostra aleatória de dez casos do banco de dados 
#| tbl-cap-location: bottom
set.seed(123)
df |> 
  slice_sample(n = 10) |> 
  gt() |> 
  cols_align(
    align = "center"  
  ) |> 
  tab_options(
    table.width = pct(100),
    table.font.size = "18px"
  ) |> 
  opt_stylize(
    style = 1, color = "gray"
  )
```

## Pacotes

Carregue os pacotes abaixo:

```{r}
#| echo: true
#| eval: false
library(tidyverse)
library(MVN)
library(EGAnet)
library(psych)
library(lavaan)
```

## Preparação dos dados para a análise

```{r}
#| echo: true
escala_de_racismo <- df |> 
  select(r1:r14) # <1>
```

1.  Criar um objeto somente com os itens da escala

## Avaliação da normalidade dos dados {.smaller}

::: panel-tabset
### Teste

```{r}
#| echo: true
resultado_normalidade <- mvn(
  escala_de_racismo, 
  mvnTest = "mardia",
  univariateTest = "SW"
)
```

### Descritivos

```{r}
#| echo: true
resultado_normalidade$Descriptives |> 
  as_tibble() |> 
  print(n = Inf)
```

### Normalidade univariada

```{r}
#| echo: true
resultado_normalidade$univariateNormality
```

### Normalidade multivariada

```{r}
#| echo: true
resultado_normalidade$multivariateNormality
```
:::

## Fatorabilidade da Matriz de Dados

::: panel-tabset
### KMO

```{r}
escala_de_racismo |> 
  polychoric.matrix() |> 
  KMO()
```
:::

## teste

-   `ordered = T` implica em "WLSMV":

    -   `estimator = "DWLS"`
    -   `se = "robust.sem"`
    -   `test = "scaled.shifted"`

```{r}
#| echo: true
resultado_afe <- efa(
  data = escala_de_racismo,
  ordered = T,
  nfactors = 2,
  rotation = "oblimin",
)
```

## Resultados

```{r}
summary(resultado_afe)
```
